<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NFC æˆ‘çš„ç”Ÿæ—¥æ›¸ Demo</title>
<style>
  body { font-family:"Noto Sans TC","Microsoft JhengHei",sans-serif; margin:0; padding:20px; background:#fffaf6; color:#333; }
  .wrap { max-width:760px; margin:0 auto; }
  h1 { text-align:center; color:#c62828; }
  .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:16px 18px; margin:12px 0; box-shadow:0 4px 14px rgba(0,0,0,.06); }
  h2 { color:#2e7d32; font-size:18px; margin:0 0 8px; }
  footer { margin-top:20px; text-align:center; color:#888; font-size:12px; }
  .wallet { font-size:18px; margin:10px 0; background:#eef7ff; border-radius:8px; padding:10px; }
  .service li { margin:8px 0; }
  .service button { margin-left:10px; }
  .thumbnail { background:#fff3e0; padding:10px; border-radius:10px; text-align:center; margin:10px 0; }
  .reset { margin-top:20px; text-align:center; }
  .reset button { padding:6px 12px; border:none; border-radius:6px; background:#c62828; color:white; cursor:pointer; }
  .history { margin-top:12px; font-size:14px; }
  .history table { width:100%; border-collapse:collapse; }
  .history th, .history td { border-bottom:1px solid #eee; padding:6px; text-align:left; }
  .history th { background:#fafafa; }
  .topup { margin:10px 0; background:#f0fff4; padding:12px; border-radius:10px; }
  .topup input { padding:6px; border:1px solid #ccc; border-radius:6px; }
  .topup button { margin-left:6px; padding:6px 12px; border:none; border-radius:6px; background:#2e7d32; color:white; cursor:pointer; }
</style>
</head>
<body>
<div class="wrap" id="app"></div>

<div class="reset">
  <button onclick="resetState()">ğŸ”„ é‡ç½®é–‹å¡ç‹€æ…‹</button>
</div>

<script>
function renderFirstTime() {
  return `
    <h1>ğŸ‚ æˆ‘çš„ç”Ÿæ—¥æ›¸ (é¦–æ¬¡é–‹å¡)</h1>
    <div class="card">
      <h2>ğŸŒ¸ ä»Šæ—¥è±¡å¾µ</h2>
      <p>ç”Ÿæ—¥èŠ±ï¼šé››èŠï¼ˆç´”çœŸã€å¸Œæœ›ï¼‰ï½œ èª•ç”ŸçŸ³ï¼šé‘½çŸ³ï¼ˆç´”æ·¨ã€å …å®šï¼‰ï½œ ä¸»å®°è¡Œæ˜Ÿï¼šç«æ˜Ÿ</p>
    </div>
    <div class="card">
      <h2>âœ¨ æ€§æ ¼æ°£è³ª</h2>
      <p>é€™ä¸€å¤©å‡ºç”Ÿçš„ä½ ï¼Œå¸¶è‘—é–‹å‰µèƒ½é‡èˆ‡è¡Œå‹•åŠ›ï¼Œç›´ç‡å¦ç™½ï¼Œå¸¸å¸¸é¡˜æ„æˆç‚ºç¬¬ä¸€å€‹ç«™å‡ºä¾†çš„äººã€‚</p>
    </div>
    <div class="card">
      <h2>ğŸŒŸ ä»Šæ—¥è¡Œå‹•</h2>
      <p>æŠŠè…¦ä¸­çš„æƒ³æ³•åšæˆ 1 å€‹å¯è½åœ°çš„ä¸‹ä¸€æ­¥ã€‚</p>
    </div>
    <div class="card">
      <h2>ğŸ é–‹å¡ç¦®</h2>
      <p>æ­å–œç²å¾— <b>20 é»æ¢ç´¢é»æ•¸</b>ï¼</p>
    </div>
    <footer>Â© 2025 NFC æˆ‘çš„ç”Ÿæ—¥æ›¸</footer>
  `;
}

function renderAfter() {
  let historyRows = loadHistory().map(
    h => `<tr><td>${h.time}</td><td>${h.service}</td><td>${h.change}</td><td>${h.remain} é»</td></tr>`
  ).join("");

  if(!historyRows) historyRows = `<tr><td colspan="4">å°šç„¡äº¤æ˜“ç´€éŒ„</td></tr>`;

  return `
    <h1>ğŸ‚ æˆ‘çš„ç”Ÿæ—¥æ›¸</h1>
    <div class="thumbnail">
      <p>ğŸ“– 0404 ç”Ÿæ—¥æ›¸ï¼ˆç¸®åœ–ç‰ˆï¼‰</p>
      <button onclick="expandBook()">å±•é–‹å®Œæ•´å…§å®¹</button>
    </div>
    <div class="wallet">ğŸ’ å‰©é¤˜é»æ•¸ï¼š<b id="points">20</b> é»</div>

    <div class="card topup">
      <h2>â• é»æ•¸åŠ å€¼</h2>
      <p>
        <input id="topupCode" placeholder="è¼¸å…¥åŠ å€¼ç¢¼" />
        <button onclick="redeemCode()">å…Œæ›</button>
        <button onclick="addPoints(10,'ç³»çµ±åŠ å€¼')">+10 é» (æ¨¡æ“¬)</button>
      </p>
    </div>

    <div class="card">
      <h2>å¯ä½¿ç”¨æœå‹™</h2>
      <ul class="service">
        <li>ç´«å¾®æµå¹´ (-3 é») <button onclick="usePoints(3,'ç´«å¾®æµå¹´')">å•Ÿç”¨</button></li>
        <li>å åœä¸€æ¬¡ (-1 é») <button onclick="usePoints(1,'å åœä¸€æ¬¡')">æŠ½ç±¤</button></li>
        <li>MBTI æª¢æ¸¬ (-5 é») <button onclick="usePoints(5,'MBTI æª¢æ¸¬')">é–‹å§‹</button></li>
      </ul>
    </div>
    <div class="card history">
      <h2>ğŸ“œ é»æ•¸äº¤æ˜“ç´€éŒ„</h2>
      <table>
        <tr><th>æ™‚é–“</th><th>æœå‹™</th><th>è®Šå‹•</th><th>å‰©é¤˜</th></tr>
        ${historyRows}
      </table>
    </div>
    <footer>å†æ¬¡ç™»å…¥ï¼šé‡é»æ˜¯é»æ•¸èˆ‡æœå‹™ ï½œ Â© 2025 NFC æˆ‘çš„ç”Ÿæ—¥æ›¸</footer>
  `;
}

function expandBook() {
  alert("é€™è£¡å¯ä»¥è¼‰å…¥å®Œæ•´ç”Ÿæ—¥æ›¸å…§å®¹é ï¼ˆ0404 å…¨æ–‡ï¼‰ã€‚");
}

function usePoints(cost, serviceName) {
  let points = parseInt(localStorage.getItem("points") || "20");
  if(points >= cost) {
    points -= cost;
    localStorage.setItem("points", points);
    document.getElementById("points").innerText = points;

    // æ–°å¢äº¤æ˜“ç´€éŒ„
    addHistory({
      time: new Date().toLocaleString(),
      service: serviceName,
      change: "- " + cost + " é»",
      remain: points
    });

    alert("âœ… æˆåŠŸæ‰£é™¤ " + cost + " é»ï¼Œè«‹äº«ç”¨ã€Œ" + serviceName + "ã€ï¼");
    init(); // é‡æ–°æ¸²æŸ“ï¼Œæ›´æ–°ç´€éŒ„è¡¨
  } else {
    alert("âš ï¸ é»æ•¸ä¸è¶³ï¼");
  }
}

function addPoints(amount, source) {
  let points = parseInt(localStorage.getItem("points") || "20");
  points += amount;
  localStorage.setItem("points", points);

  addHistory({
    time: new Date().toLocaleString(),
    service: source,
    change: "+ " + amount + " é»",
    remain: points
  });

  alert("âœ… å·²åŠ å€¼ " + amount + " é»ï¼");
  init();
}

function redeemCode() {
  let code = document.getElementById("topupCode").value.trim();
  if(!code) { alert("è«‹è¼¸å…¥åŠ å€¼ç¢¼ï¼"); return; }
  // ç°¡å–®æ¨¡æ“¬ï¼šè¼¸å…¥ "HAPPYBDAY" â†’ +5 é»
  if(code === "HAPPYBDAY") {
    addPoints(5,"åŠ å€¼ç¢¼ "+code);
    document.getElementById("topupCode").value = "";
  } else {
    alert("âš ï¸ ç„¡æ•ˆçš„åŠ å€¼ç¢¼ï¼");
  }
}

function addHistory(entry) {
  let history = loadHistory();
  history.push(entry);
  localStorage.setItem("history", JSON.stringify(history));
}

function loadHistory() {
  return JSON.parse(localStorage.getItem("history") || "[]");
}

function init() {
  const opened = localStorage.getItem("first_opened");
  if(!opened) {
    // ç¬¬ä¸€æ¬¡é–‹å¡
    document.getElementById("app").innerHTML = renderFirstTime();
    localStorage.setItem("first_opened", "1");
    localStorage.setItem("points", "20"); // åˆå§‹åŒ–é»æ•¸
    localStorage.setItem("history", "[]");
  } else {
    // ä¹‹å¾Œç™»å…¥
    document.getElementById("app").innerHTML = renderAfter();
    document.getElementById("points").innerText = localStorage.getItem("points");
  }
}

function resetState() {
  localStorage.removeItem("first_opened");
  localStorage.removeItem("points");
  localStorage.removeItem("history");
  alert("ğŸ”„ å·²é‡ç½®ï¼Œä¸‹æ¬¡é‡æ–°æ•´ç†é é¢æœƒæ¨¡æ“¬ã€ç¬¬ä¸€æ¬¡é–‹å¡ã€");
  location.reload();
}

init();
</script>
</body>
</html>
