<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¡”ç¾…å åœçµæœ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 540px;
      margin: auto;
      text-align: center;
    }

    .card-container {
      perspective: 1000px;
      display: inline-block;
      margin: 20px 10px;
    }

    .card {
      width: 160px;
      height: 260px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 1s;
      cursor: pointer;
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      overflow: hidden;
    }

    .card-front {
      transform: rotateY(180deg);
    }

    .card-face img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .desc {
      margin-top: 8px;
      font-size: 16px;
    }

    .label {
      font-weight: bold;
      margin-bottom: 6px;
    }
  </style>
</head>
<body>
  <h2>ğŸ”® å åœçµæœ</h2>
  <p id="subtitle"></p>
  <div id="result">æ­£åœ¨æŠ½ç‰Œ...</div>

  <script>
    const tarotPath = "./img/";
    const tarotJSON = "./tarot_22_cards_tw.json";
    const cardBackImage = tarotPath + "card_back_n2g.png"; // è«‹ç¢ºèªæ­¤åœ–å·²ä¸Šå‚³

    const params = new URLSearchParams(location.search);
    const tp = params.get("tp");
    const uid = params.get("uid");
    const token = params.get("token");

    const labels = ["éå»", "ç¾åœ¨", "æœªä¾†"];

    function drawCards(tp, deck) {
      const result = document.getElementById("result");
      const subtitle = document.getElementById("subtitle");
      let drawn = [];

      if (tp === "T1") {
        drawn = [deck[Math.floor(Math.random() * deck.length)]];
        subtitle.innerText = "å–®å¼µå åœ";
      } else if (tp === "T3") {
        while (drawn.length < 3) {
          const card = deck[Math.floor(Math.random() * deck.length)];
          if (!drawn.includes(card)) drawn.push(card);
        }
        subtitle.innerText = "ä¸‰å¼µç‰Œå åœï¼ˆéå»ï¼ç¾åœ¨ï¼æœªä¾†ï¼‰";
      } else {
        const today = new Date().getDate();
        drawn = [deck[today % deck.length]];
        subtitle.innerText = "æ¯æ—¥å»ºè­°";
      }

      result.innerHTML = "";

      drawn.forEach((card, idx) => {
        const cardDiv = document.createElement("div");
        cardDiv.className = "card-container";

        const label = tp === "T3" ? `<div class="label">${labels[idx]}</div>` : "";

        cardDiv.innerHTML = `
          ${label}
          <div class="card">
            <div class="card-face card-back">
              <img src="${cardBackImage}" alt="èƒŒé¢">
            </div>
            <div class="card-face card-front">
              <img src="${tarotPath}${card.image}" alt="${card.description}">
            </div>
          </div>
          <div class="desc">${card.description}</div>
        `;
        result.appendChild(cardDiv);
      });

      // åŠ å…¥é»æ“Šç¿»ç‰Œæ•ˆæœ
      document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('click', () => {
          card.classList.toggle('flipped');
        });
      });
    }

    fetch(tarotJSON)
      .then(res => res.json())
      .then(data => drawCards(tp, data))
      .catch(err => {
        document.getElementById("result").innerHTML = "âŒ éŒ¯èª¤ï¼š" + err;
      });
  </script>
</body>
</html>
